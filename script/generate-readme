#!/bin/sh

set -e

CDPATH="" cd -- "$(dirname -- "$(dirname -- "$0")")"

cmd_readme() {
  cmd_name="$1"
  cat <<EOF >"./cmd/$cmd_name/README.md"
## $cmd_name

### Install

#### go get

\`\`\`
go get github.com/willabides/piper/cmd/$cmd_name
\`\`\`

#### bindown

Add a [bindown](https://github.com/willabides/bindown) dependency:

\`\`\`
$ bindown template-source add piper https://github.com/WillAbides/piper/releases/latest/download/bindown-templates.yml
$ bindown dependency add $cmd_name piper#$cmd_name
\`\`\`

### Usage

\`\`\`
$("script/$cmd_name" --help)
\`\`\`

EOF
}

cmd_readme eventbridge-pipe
cmd_readme eventgrid-pipe
cmd_readme splunk-pipe

line_no="$(grep -n \
  '<!--- Past here is generated by generate-readme DO NOT EDIT --->' \
  README.md | cut -d: -f1)"

readme="$(head -"$line_no" ./README.md)"
{
  echo "$readme"

  printf "\n---\n\n"
  cat ./cmd/eventbridge-pipe/README.md

  printf "\n---\n\n"
  cat ./cmd/eventgrid-pipe/README.md

  printf "\n---\n\n"
  cat ./cmd/splunk-pipe/README.md
} > ./README.md
