#!/bin/sh

set -e

CDPATH="" cd -- "$(dirname -- "$(dirname -- "$0")")"

cmd_readme() {
  cmd_dir="$1"
  cmd_name="$(basename "$cmd_dir")"
  cat <<EOF >"$cmd_dir/README.md"
## $cmd_name

### Install

#### go get

\`\`\`
go get github.com/willabides/piper/cmd/$cmd_name
\`\`\`

#### bindown

Add a [bindown](https://github.com/willabides/bindown) dependency:

\`\`\`
$ bindown template-source add piper https://github.com/WillAbides/piper/releases/latest/download/bindown-templates.yml
$ bindown dependency add $cmd_name piper#$cmd_name
\`\`\`

### Usage

\`\`\`
$("script/$cmd_name" --help)
\`\`\`

EOF
}

line_no="$(grep -n \
  '<!--- Past here is generated by generate-readme DO NOT EDIT --->' \
  README.md | cut -d: -f1)"

readme="$(head -"$line_no" ./README.md)"

for cmd_dir in ./cmd/*; do
  cmd_readme "$cmd_dir"

  readme="$readme

---

$(cat "$cmd_dir/README.md")
"

done

echo "$readme" > ./README.md
